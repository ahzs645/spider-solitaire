import AceClubs from '../../assets/images/cards/new/Ace_Clubs.png';
import AceClubsInverse from '../../assets/images/cards/new/Ace_Clubs_Inverse.png';
import AceDiamonds from '../../assets/images/cards/new/Ace_Diamonds.png';
import AceDiamondsInverse from '../../assets/images/cards/new/Ace_Diamonds_Inverse.png';
import AceHearts from '../../assets/images/cards/new/Ace_Hearts.png';
import AceHeartsInverse from '../../assets/images/cards/new/Ace_Hearts_Inverse.png';
import AceSpades from '../../assets/images/cards/new/Ace_Spades.png';
import AceSpadesInverse from '../../assets/images/cards/new/Ace_Spades_Inverse.png';
import TwoClubs from '../../assets/images/cards/new/2_Clubs.png';
import TwoClubsInverse from '../../assets/images/cards/new/2_Clubs_Inverse.png';
import TwoDiamonds from '../../assets/images/cards/new/2_Diamonds.png';
import TwoDiamondsInverse from '../../assets/images/cards/new/2_Diamonds_Inverse.png';
import TwoHearts from '../../assets/images/cards/new/2_Hearts.png';
import TwoHeartsInverse from '../../assets/images/cards/new/2_Hearts_Inverse.png';
import TwoSpades from '../../assets/images/cards/new/2_Spades.png';
import TwoSpadesInverse from '../../assets/images/cards/new/2_Spades_Inverse.png';
import ThreeClubs from '../../assets/images/cards/new/3_Clubs.png';
import ThreeClubsInverse from '../../assets/images/cards/new/3_Clubs_Inverse.png';
import ThreeDiamonds from '../../assets/images/cards/new/3_Diamonds.png';
import ThreeDiamondsInverse from '../../assets/images/cards/new/3_Diamonds_Inverse.png';
import ThreeHearts from '../../assets/images/cards/new/3_Hearts.png';
import ThreeHeartsInverse from '../../assets/images/cards/new/3_Hearts_Inverse.png';
import ThreeSpades from '../../assets/images/cards/new/3_Spades.png';
import ThreeSpadesInverse from '../../assets/images/cards/new/3_Spades_Inverse.png';
import FourClubs from '../../assets/images/cards/new/4_Clubs.png';
import FourClubsInverse from '../../assets/images/cards/new/4_Clubs_Inverse.png';
import FourDiamonds from '../../assets/images/cards/new/4_Diamonds.png';
import FourDiamondsInverse from '../../assets/images/cards/new/4_Diamonds_Inverse.png';
import FourHearts from '../../assets/images/cards/new/4_Hearts.png';
import FourHeartsInverse from '../../assets/images/cards/new/4_Hearts_Inverse.png';
import FourSpades from '../../assets/images/cards/new/4_Spades.png';
import FourSpadesInverse from '../../assets/images/cards/new/4_Spades_Inverse.png';
import FiveClubs from '../../assets/images/cards/new/5_Clubs.png';
import FiveClubsInverse from '../../assets/images/cards/new/5_Clubs_Inverse.png';
import FiveDiamonds from '../../assets/images/cards/new/5_Diamonds.png';
import FiveDiamondsInverse from '../../assets/images/cards/new/5_Diamonds_Inverse.png';
import FiveHearts from '../../assets/images/cards/new/5_Hearts.png';
import FiveHeartsInverse from '../../assets/images/cards/new/5_Hearts_Inverse.png';
import FiveSpades from '../../assets/images/cards/new/5_Spades.png';
import FiveSpadesInverse from '../../assets/images/cards/new/5_Spades_Inverse.png';
import SixClubs from '../../assets/images/cards/new/6_Clubs.png';
import SixClubsInverse from '../../assets/images/cards/new/6_Clubs_Inverse.png';
import SixDiamonds from '../../assets/images/cards/new/6_Diamonds.png';
import SixDiamondsInverse from '../../assets/images/cards/new/6_Diamonds_Inverse.png';
import SixHearts from '../../assets/images/cards/new/6_Hearts.png';
import SixHeartsInverse from '../../assets/images/cards/new/6_Hearts_Inverse.png';
import SixSpades from '../../assets/images/cards/new/6_Spades.png';
import SixSpadesInverse from '../../assets/images/cards/new/6_Spades_Inverse.png';
import SevenClubs from '../../assets/images/cards/new/7_Clubs.png';
import SevenClubsInverse from '../../assets/images/cards/new/7_Clubs_Inverse.png';
import SevenDiamonds from '../../assets/images/cards/new/7_Diamonds.png';
import SevenDiamondsInverse from '../../assets/images/cards/new/7_Diamonds_Inverse.png';
import SevenHearts from '../../assets/images/cards/new/7_Hearts.png';
import SevenHeartsInverse from '../../assets/images/cards/new/7_Hearts_Inverse.png';
import SevenSpades from '../../assets/images/cards/new/7_Spades.png';
import SevenSpadesInverse from '../../assets/images/cards/new/7_Spades_Inverse.png';
import EightClubs from '../../assets/images/cards/new/8_Clubs.png';
import EightClubsInverse from '../../assets/images/cards/new/8_Clubs_Inverse.png';
import EightDiamonds from '../../assets/images/cards/new/8_Diamonds.png';
import EightDiamondsInverse from '../../assets/images/cards/new/8_Diamonds_Inverse.png';
import EightHearts from '../../assets/images/cards/new/8_Hearts.png';
import EightHeartsInverse from '../../assets/images/cards/new/8_Hearts_Inverse.png';
import EightSpades from '../../assets/images/cards/new/8_Spades.png';
import EightSpadesInverse from '../../assets/images/cards/new/8_Spades_Inverse.png';
import NineClubs from '../../assets/images/cards/new/9_Clubs.png';
import NineClubsInverse from '../../assets/images/cards/new/9_Clubs_Inverse.png';
import NineDiamonds from '../../assets/images/cards/new/9_Diamonds.png';
import NineDiamondsInverse from '../../assets/images/cards/new/9_Diamonds_Inverse.png';
import NineHearts from '../../assets/images/cards/new/9_Hearts.png';
import NineHeartsInverse from '../../assets/images/cards/new/9_Hearts_Inverse.png';
import NineSpades from '../../assets/images/cards/new/9_Spades.png';
import NineSpadesInverse from '../../assets/images/cards/new/9_Spades_Inverse.png';
import TenClubs from '../../assets/images/cards/new/10_Clubs.png';
import TenClubsInverse from '../../assets/images/cards/new/10_Clubs_Inverse.png';
import TenDiamonds from '../../assets/images/cards/new/10_Diamonds.png';
import TenDiamondsInverse from '../../assets/images/cards/new/10_Diamonds_Inverse.png';
import TenHearts from '../../assets/images/cards/new/10_Hearts.png';
import TenHeartsInverse from '../../assets/images/cards/new/10_Hearts_Inverse.png';
import TenSpades from '../../assets/images/cards/new/10_Spades.png';
import TenSpadesInverse from '../../assets/images/cards/new/10_Spades_Inverse.png';
import JackClubs from '../../assets/images/cards/new/Jack_Clubs.png';
import JackClubsInverse from '../../assets/images/cards/new/Jack_Clubs_Inverse.png';
import JackDiamonds from '../../assets/images/cards/new/Jack_Diamonds.png';
import JackDiamondsInverse from '../../assets/images/cards/new/Jack_Diamonds_Inverse.png';
import JackHearts from '../../assets/images/cards/new/Jack_Hearts.png';
import JackHeartsInverse from '../../assets/images/cards/new/Jack_Hearts_Inverse.png';
import JackSpades from '../../assets/images/cards/new/Jack_Spades.png';
import JackSpadesInverse from '../../assets/images/cards/new/Jack_Spades_Inverse.png';
import QueenClubs from '../../assets/images/cards/new/Queen_Clubs.png';
import QueenClubsInverse from '../../assets/images/cards/new/Queen_Clubs_Inverse.png';
import QueenDiamonds from '../../assets/images/cards/new/Queen_Diamonds.png';
import QueenDiamondsInverse from '../../assets/images/cards/new/Queen_Diamonds_Inverse.png';
import QueenHearts from '../../assets/images/cards/new/Queen_Hearts.png';
import QueenHeartsInverse from '../../assets/images/cards/new/Queen_Hearts_Inverse.png';
import QueenSpades from '../../assets/images/cards/new/Queen_Spades.png';
import QueenSpadesInverse from '../../assets/images/cards/new/Queen_Spades_Inverse.png';
import KingClubs from '../../assets/images/cards/new/King_Clubs.png';
import KingClubsInverse from '../../assets/images/cards/new/King_Clubs_Inverse.png';
import KingDiamonds from '../../assets/images/cards/new/King_Diamonds.png';
import KingDiamondsInverse from '../../assets/images/cards/new/King_Diamonds_Inverse.png';
import KingHearts from '../../assets/images/cards/new/King_Hearts.png';
import KingHeartsInverse from '../../assets/images/cards/new/King_Hearts_Inverse.png';
import KingSpades from '../../assets/images/cards/new/King_Spades.png';
import KingSpadesInverse from '../../assets/images/cards/new/King_Spades_Inverse.png';
import CardBackSpider from '../../assets/images/cards/new/Card_Back_Spider.png';

export const cardBackImage = CardBackSpider;

const clubsFaceAssets = {
  Ace: AceClubs,
  Two: TwoClubs,
  Three: ThreeClubs,
  Four: FourClubs,
  Five: FiveClubs,
  Six: SixClubs,
  Seven: SevenClubs,
  Eight: EightClubs,
  Nine: NineClubs,
  Ten: TenClubs,
  Jack: JackClubs,
  Queen: QueenClubs,
  King: KingClubs,
};

const clubsInverseAssets = {
  Ace: AceClubsInverse,
  Two: TwoClubsInverse,
  Three: ThreeClubsInverse,
  Four: FourClubsInverse,
  Five: FiveClubsInverse,
  Six: SixClubsInverse,
  Seven: SevenClubsInverse,
  Eight: EightClubsInverse,
  Nine: NineClubsInverse,
  Ten: TenClubsInverse,
  Jack: JackClubsInverse,
  Queen: QueenClubsInverse,
  King: KingClubsInverse,
};

const diamondsFaceAssets = {
  Ace: AceDiamonds,
  Two: TwoDiamonds,
  Three: ThreeDiamonds,
  Four: FourDiamonds,
  Five: FiveDiamonds,
  Six: SixDiamonds,
  Seven: SevenDiamonds,
  Eight: EightDiamonds,
  Nine: NineDiamonds,
  Ten: TenDiamonds,
  Jack: JackDiamonds,
  Queen: QueenDiamonds,
  King: KingDiamonds,
};

const diamondsInverseAssets = {
  Ace: AceDiamondsInverse,
  Two: TwoDiamondsInverse,
  Three: ThreeDiamondsInverse,
  Four: FourDiamondsInverse,
  Five: FiveDiamondsInverse,
  Six: SixDiamondsInverse,
  Seven: SevenDiamondsInverse,
  Eight: EightDiamondsInverse,
  Nine: NineDiamondsInverse,
  Ten: TenDiamondsInverse,
  Jack: JackDiamondsInverse,
  Queen: QueenDiamondsInverse,
  King: KingDiamondsInverse,
};

const heartsFaceAssets = {
  Ace: AceHearts,
  Two: TwoHearts,
  Three: ThreeHearts,
  Four: FourHearts,
  Five: FiveHearts,
  Six: SixHearts,
  Seven: SevenHearts,
  Eight: EightHearts,
  Nine: NineHearts,
  Ten: TenHearts,
  Jack: JackHearts,
  Queen: QueenHearts,
  King: KingHearts,
};

const heartsInverseAssets = {
  Ace: AceHeartsInverse,
  Two: TwoHeartsInverse,
  Three: ThreeHeartsInverse,
  Four: FourHeartsInverse,
  Five: FiveHeartsInverse,
  Six: SixHeartsInverse,
  Seven: SevenHeartsInverse,
  Eight: EightHeartsInverse,
  Nine: NineHeartsInverse,
  Ten: TenHeartsInverse,
  Jack: JackHeartsInverse,
  Queen: QueenHeartsInverse,
  King: KingHeartsInverse,
};

const spadesFaceAssets = {
  Ace: AceSpades,
  Two: TwoSpades,
  Three: ThreeSpades,
  Four: FourSpades,
  Five: FiveSpades,
  Six: SixSpades,
  Seven: SevenSpades,
  Eight: EightSpades,
  Nine: NineSpades,
  Ten: TenSpades,
  Jack: JackSpades,
  Queen: QueenSpades,
  King: KingSpades,
};

const spadesInverseAssets = {
  Ace: AceSpadesInverse,
  Two: TwoSpadesInverse,
  Three: ThreeSpadesInverse,
  Four: FourSpadesInverse,
  Five: FiveSpadesInverse,
  Six: SixSpadesInverse,
  Seven: SevenSpadesInverse,
  Eight: EightSpadesInverse,
  Nine: NineSpadesInverse,
  Ten: TenSpadesInverse,
  Jack: JackSpadesInverse,
  Queen: QueenSpadesInverse,
  King: KingSpadesInverse,
};

const FACE_CARD_ASSETS = {
  clubs: clubsFaceAssets,
  diamonds: diamondsFaceAssets,
  hearts: heartsFaceAssets,
  spades: spadesFaceAssets,
};

const INVERSE_CARD_ASSETS = {
  clubs: clubsInverseAssets,
  diamonds: diamondsInverseAssets,
  hearts: heartsInverseAssets,
  spades: spadesInverseAssets,
};

export const CARD_SUITS = ['spades', 'hearts', 'clubs', 'diamonds'];
export const COPIES_PER_SUIT = 2;

const CARD_RANKS = [
  { key: 'ace', value: 1, label: 'A', assetKey: 'Ace' },
  { key: 'two', value: 2, label: '2', assetKey: 'Two' },
  { key: 'three', value: 3, label: '3', assetKey: 'Three' },
  { key: 'four', value: 4, label: '4', assetKey: 'Four' },
  { key: 'five', value: 5, label: '5', assetKey: 'Five' },
  { key: 'six', value: 6, label: '6', assetKey: 'Six' },
  { key: 'seven', value: 7, label: '7', assetKey: 'Seven' },
  { key: 'eight', value: 8, label: '8', assetKey: 'Eight' },
  { key: 'nine', value: 9, label: '9', assetKey: 'Nine' },
  { key: 'ten', value: 10, label: '10', assetKey: 'Ten' },
  { key: 'jack', value: 11, label: 'J', assetKey: 'Jack' },
  { key: 'queen', value: 12, label: 'Q', assetKey: 'Queen' },
  { key: 'king', value: 13, label: 'K', assetKey: 'King' },
];

export const cardNo = CARD_RANKS.reduce((accumulator, rank) => {
  accumulator[rank.key] = rank.value;
  return accumulator;
}, {});

export const cardCounts = CARD_RANKS.reduce((accumulator, rank) => {
  accumulator[rank.key] = CARD_SUITS.length * COPIES_PER_SUIT;
  return accumulator;
}, {});

const buildCardImageMap = (assetsBySuit) => {
  return CARD_SUITS.reduce((accumulator, suit) => {
    accumulator[suit] = {};
    CARD_RANKS.forEach(({ value, assetKey }) => {
      accumulator[suit][value] = assetsBySuit[suit][assetKey];
    });
    return accumulator;
  }, {});
};

export const cardImages = buildCardImageMap(FACE_CARD_ASSETS);
export const cardInverseImages = buildCardImageMap(
  INVERSE_CARD_ASSETS
);

export const getCardNo = (name) => {
  return cardNo[name];
};

export const getRankLabel = (rank) => {
  const match = CARD_RANKS.find((item) => item.value === rank);
  return match ? match.label : `${rank}`;
};

const SUIT_SYMBOLS = {
  spades: '♠',
  hearts: '♥',
  clubs: '♣',
  diamonds: '♦',
};

export const getSuitSymbol = (suit) => {
  return SUIT_SYMBOLS[suit] || '?';
};

export const isRedSuit = (suit) => {
  return suit === 'hearts' || suit === 'diamonds';
};

const generateFullDeck = () => {
  const deck = [];

  CARD_SUITS.forEach((suit) => {
    for (let copy = 0; copy < COPIES_PER_SUIT; copy += 1) {
      CARD_RANKS.forEach((rank) => {
        deck.push({
          id: `${suit}-${rank.value}-${copy}`,
          suit,
          rank: rank.value,
        });
      });
    }
  });

  return deck;
};

/*
  ====================================================
  Shuffle the deck with the Fisher algorithm.
  Return value: Array
  ====================================================
*/

export const shuffle = (array) => {
  const copyArray = [...array];

  for (let i = copyArray.length - 1; i > 0; i -= 1) {
    const j = Math.floor(Math.random() * (i + 1));
    [copyArray[i], copyArray[j]] = [copyArray[j], copyArray[i]];
  }
  return copyArray;
};

const isDescendingRun = (cards) => {
  if (cards.length === 0) {
    return false;
  }

  for (let i = 1; i < cards.length; i += 1) {
    const previous = cards[i - 1];
    const current = cards[i];

    if (
      previous.suit !== current.suit ||
      previous.rank !== current.rank + 1
    ) {
      return false;
    }
  }

  return true;
};

/*
  ====================================================
  Checks if there is a completed card sequence in the deck.
  Return value: Boolean
  ====================================================
*/

export const checkCompletedDeck = (cards) => {
  if (cards.length < 13) {
    return false;
  }

  const candidate = cards.slice(-13);

  if (
    candidate[0].rank !== 13 ||
    candidate[candidate.length - 1].rank !== 1
  ) {
    return false;
  }

  return isDescendingRun(candidate);
};

const getClampedVisibleCardCount = (deck) => {
  if (deck.cards.length === 0) {
    return 0;
  }

  return Math.min(deck.visibleCardCount, deck.cards.length);
};

/*
  ====================================================
  Moves cards from one deck to another.
  Return value: Object
  ====================================================
*/

export const moveCards = (cardDecks, source, destination) => {
  // Information of source deck.
  const sourceCardIndex = source.index;
  const sourceDeckId = source.droppableId;
  const sourceDeck = { ...cardDecks[sourceDeckId] };

  // Information of destination deck.
  const destinationCardIndex = destination.index;
  const destinationDeckId = destination.droppableId;
  const destinationDeck = { ...cardDecks[destinationDeckId] };

  // The drag card and the cards below it.
  const selectedCardList = sourceDeck.cards.splice(sourceCardIndex);

  const parentCard =
    destinationDeck.cards[destinationCardIndex - 1];

  const canStackOnDestination =
    destinationCardIndex === 0 ||
    (parentCard &&
      selectedCardList[0] &&
      parentCard.suit === selectedCardList[0].suit &&
      parentCard.rank === selectedCardList[0].rank + 1);

  const canMoveStack =
    selectedCardList.length > 0 && isDescendingRun(selectedCardList);

  let isDragSuccessful = false;

  if (canStackOnDestination && canMoveStack) {
    destinationDeck.cards.push(...selectedCardList);
    isDragSuccessful = true;

    if (sourceDeck.cards.length === 0) {
      sourceDeck.visibleCardCount = 0;
    } else if (
      sourceDeck.visibleCardCount === selectedCardList.length
    ) {
      sourceDeck.visibleCardCount = 1;
    } else {
      sourceDeck.visibleCardCount -= selectedCardList.length;
    }

    destinationDeck.visibleCardCount += selectedCardList.length;
  } else {
    // If the drag fails, put the cards back.
    sourceDeck.cards.push(...selectedCardList);
  }

  sourceDeck.visibleCardCount =
    getClampedVisibleCardCount(sourceDeck);
  destinationDeck.visibleCardCount =
    getClampedVisibleCardCount(destinationDeck);

  // Check if there is a completed deck as a result of drag.
  const isThereACompletedDeck = checkCompletedDeck(
    destinationDeck.cards
  );

  if (isThereACompletedDeck) {
    destinationDeck.cards.splice(-13);
    const deduction =
      destinationDeck.visibleCardCount === 13 ? 12 : 13;
    destinationDeck.visibleCardCount = Math.max(
      0,
      destinationDeck.visibleCardCount - deduction
    );
    destinationDeck.visibleCardCount =
      getClampedVisibleCardCount(destinationDeck);
  }

  return {
    newCardDecks: {
      ...cardDecks,
      [sourceDeckId]: sourceDeck,
      [destinationDeckId]: destinationDeck,
    },
    isThereACompletedDeck,
    isDragSuccessful,
  };
};

/*
  ====================================================
  Deals one new card to 10 decks.
  Return value: Array
  ====================================================
*/

export const deal = (cardDecks, dealingCards, cannotDealSound) => {
  const copyDealingDecks = [...dealingCards];

  const canDeal = Object.values(cardDecks).every(
    (deck) => deck.cards.length > 0
  );

  if (canDeal) {
    const dealCards = copyDealingDecks.pop();

    if (dealCards) {
      /* eslint-disable no-param-reassign */
      Object.entries(cardDecks).forEach(([, deck]) => {
        deck.cards.push(dealCards.shift());
        deck.visibleCardCount += 1;
        deck.visibleCardCount = getClampedVisibleCardCount(deck);
      });
      /* eslint-enable no-param-reassign */
    }
  } else {
    cannotDealSound.play();
  }

  return [{ ...cardDecks }, [...copyDealingDecks]];
};

/*
  ====================================================
  Set up decks for game start.
  Return value: Array
  ====================================================
*/

export const getRandomDecks = () => {
  const shuffledCardList = shuffle(generateFullDeck());

  return [
    {
      deck1: {
        cards: shuffledCardList.slice(0, 6),
        visibleCardCount: 1,
      },
      deck2: {
        cards: shuffledCardList.slice(6, 12),
        visibleCardCount: 1,
      },
      deck3: {
        cards: shuffledCardList.slice(12, 18),
        visibleCardCount: 1,
      },
      deck4: {
        cards: shuffledCardList.slice(18, 24),
        visibleCardCount: 1,
      },
      deck5: {
        cards: shuffledCardList.slice(24, 29),
        visibleCardCount: 1,
      },
      deck6: {
        cards: shuffledCardList.slice(29, 34),
        visibleCardCount: 1,
      },
      deck7: {
        cards: shuffledCardList.slice(34, 39),
        visibleCardCount: 1,
      },
      deck8: {
        cards: shuffledCardList.slice(39, 44),
        visibleCardCount: 1,
      },
      deck9: {
        cards: shuffledCardList.slice(44, 49),
        visibleCardCount: 1,
      },
      deck10: {
        cards: shuffledCardList.slice(49, 54),
        visibleCardCount: 1,
      },
    },
    // Deal decks.
    [
      shuffledCardList.slice(54, 64),
      shuffledCardList.slice(64, 74),
      shuffledCardList.slice(74, 84),
      shuffledCardList.slice(84, 94),
      shuffledCardList.slice(94, 104),
    ],
  ];
};

/*
  ====================================================
  Set up new game.
  Return value: Array
  ====================================================
*/

export const newGame = () => {
  return getRandomDecks();
};

/*
  ====================================================
  Returns the index of the first draggable card in a deck.
  Return value: Integer
  ====================================================
*/

export const getIndexWhichNextCardsDraggable = (deck) => {
  // Returns the starting index of draggable sequential cards.
  const visibleCardsStartingIndex =
    deck.cards.length - deck.visibleCardCount;

  let firstIndexOfOrderedCards = Math.max(
    visibleCardsStartingIndex,
    0
  );

  for (
    let i = visibleCardsStartingIndex;
    i < deck.cards.length - 1;
    i += 1
  ) {
    const currentCard = deck.cards[i];
    const nextCard = deck.cards[i + 1];

    if (
      !currentCard ||
      !nextCard ||
      currentCard.suit !== nextCard.suit ||
      currentCard.rank !== nextCard.rank + 1
    ) {
      firstIndexOfOrderedCards = i + 1;
    }
  }

  return firstIndexOfOrderedCards;
};

/*
  ====================================================
  Returns the starting index of the draggable cards of all decks.
  Return value: Array
  ====================================================
*/

export const getOrderedCardListsFromDecks = (cardDecks) => {
  const orderedCardListsFromDecks = [];

  Object.entries(cardDecks).forEach(([, deck]) => {
    const startingIndex = getIndexWhichNextCardsDraggable(deck);

    orderedCardListsFromDecks.push({
      startingIndex,
      cards: deck.cards.slice(startingIndex),
    });
  });

  return orderedCardListsFromDecks;
};

/*
  ====================================================
  Shows hints of cards that can be played.
  Return value: Object | undefined
  ====================================================
*/

export const getHint = (cardDecks) => {
  const orderedCardLists = getOrderedCardListsFromDecks(cardDecks);
  const hints = [];

  orderedCardLists.forEach((sourceDeck, sourceDeckNo) => {
    sourceDeck.cards.forEach((card, offset) => {
      orderedCardLists.forEach(
        (destinationDeck, destinationDeckNo) => {
          if (sourceDeckNo === destinationDeckNo) {
            return;
          }

          const destinationCards = destinationDeck.cards;

          if (destinationCards.length === 0) {
            return;
          }

          const destinationTop =
            destinationCards[destinationCards.length - 1];

          if (
            destinationTop.suit === card.suit &&
            destinationTop.rank === card.rank + 1
          ) {
            hints.push({
              sourceDeckId: `deck${sourceDeckNo + 1}`,
              destinationDeckId: `deck${destinationDeckNo + 1}`,
              sourceStartingIndex:
                sourceDeck.startingIndex + offset,
              destinationStartingIndex:
                destinationDeck.startingIndex,
            });
          }
        }
      );
    });
  });

  return hints.length > 0 ? shuffle(hints)[0] : undefined;
};
